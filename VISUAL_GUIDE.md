# ğŸ¨ Marker RAG System - Visual Architecture & Guide

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  React Web App (localhost:5173)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Chat Tab   â”‚  Index Tab   â”‚ Settings Tab â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP/JSON
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI BACKEND                               â”‚
â”‚                  (localhost:8000/api/rag)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ /health      â”‚  â”‚ /index       â”‚  â”‚ /query       â”‚          â”‚
â”‚  â”‚ Health Check â”‚  â”‚ Index Docs   â”‚  â”‚ Q&A Engine   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ /config      â”‚  â”‚ /stats       â”‚  â”‚ /clear       â”‚          â”‚
â”‚  â”‚ Configurationâ”‚  â”‚ Statistics   â”‚  â”‚ Reset Index  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Uses
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RAG PIPELINE (marker/rag/)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RAGIndexer (Orchestrator)                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Coordinate all components                           â”‚  â”‚
â”‚  â”‚  â””â”€ Handle document processing                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   â”‚                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â–¼               â–¼               â–¼                  â–¼         â”‚
â”‚                                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Chunking   â”‚ â”‚ Embeddings  â”‚ â”‚ Vector Store â”‚ â”‚ Retrieval â”‚ â”‚
â”‚ â”‚             â”‚ â”‚             â”‚ â”‚              â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ Splits text â”‚ â”‚ Creates 384 â”‚ â”‚ ChromaDB     â”‚ â”‚ Finds top â”‚ â”‚
â”‚ â”‚ into chunks â”‚ â”‚ dimensional â”‚ â”‚ storage      â”‚ â”‚ k similar â”‚ â”‚
â”‚ â”‚ (800 tokens)â”‚ â”‚ vectors     â”‚ â”‚ (persistent) â”‚ â”‚ chunks    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚              â”‚  LLM (OllamaLLM Integration)   â”‚                 â”‚
â”‚              â”‚                                â”‚                 â”‚
â”‚              â”‚ Takes: Query + Retrieved Chunksâ”‚                 â”‚
â”‚              â”‚ Returns: Answer with Citations â”‚                 â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Uses
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXTERNAL SERVICES                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     Ollama API       â”‚      â”‚   File System        â”‚         â”‚
â”‚  â”‚  localhost:11434     â”‚      â”‚                      â”‚         â”‚
â”‚  â”‚                      â”‚      â”‚  Markdown/JSON docs  â”‚         â”‚
â”‚  â”‚ â€¢ gemma2:2b          â”‚      â”‚  to index            â”‚         â”‚
â”‚  â”‚ â€¢ llama2:7b          â”‚      â”‚                      â”‚         â”‚
â”‚  â”‚ â€¢ llama3:8b          â”‚      â”‚  ChromaDB Storage    â”‚         â”‚
â”‚  â”‚ â€¢ qwen2.5:7b         â”‚      â”‚  ./rag_db/           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

### Indexing Flow

```
PDF Document
    â”‚
    â–¼
Marker CLI (convert to Markdown)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Markdown Text  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Semantic Chunking                   â”‚
â”‚  Split by paragraphs & headings      â”‚
â”‚  Keep metadata (heading, page, etc)  â”‚
â”‚  ~800 tokens per chunk               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Embedding Generation                â”‚
â”‚  all-MiniLM-L6-v2 model              â”‚
â”‚  384-dimensional vectors             â”‚
â”‚  Batch processing                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vector Store (ChromaDB)             â”‚
â”‚  Store chunks + embeddings + metadataâ”‚
â”‚  Persistent storage (./rag_db)       â”‚
â”‚  Ready for semantic search           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
âœ… Document Indexed & Searchable
```

### Query Flow

```
User Query
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Convert to Embeddingâ”‚
â”‚  Using same model    â”‚
â”‚  as indexing         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vector Similarity Search            â”‚
â”‚  Find top-k similar chunks           â”‚
â”‚  Score by semantic similarity        â”‚
â”‚  Filter by threshold                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Construct LLM Prompt                â”‚
â”‚  Query + Retrieved Chunks + Context  â”‚
â”‚  Instructions to cite sources        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Call Ollama LLM                     â”‚
â”‚  Generate contextual answer          â”‚
â”‚  Include source citations            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return Result                       â”‚
â”‚  â€¢ Answer text                       â”‚
â”‚  â€¢ Sources with similarity scores    â”‚
â”‚  â€¢ Confidence level                  â”‚
â”‚  â€¢ Tokens used                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
âœ… User Gets Cited Answer
```

---

## ğŸ¯ Component Interaction Map

```
                         User
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼
      Chat UI         Index UI        Settings UI
         â”‚                â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   RAGPanel Component
                   (State Manager)
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼
    useRAGAPI Hook   (custom hook for all API calls)
         â”‚                â”‚                â”‚
         â”‚                â–¼                â”‚
         â”‚         FastAPI Backend        â”‚
         â”‚                â”‚               â”‚
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚     â”‚          â”‚          â”‚   â”‚
         â”‚     â–¼          â–¼          â–¼   â”‚
         â”‚    /index     /query    /config
         â”‚     â”‚          â”‚          â”‚
         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚
         â–¼                â–¼
   RAG Pipeline      Components Used
   (marker/rag/)          â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        â”‚       â”‚       â”‚
         â–¼        â–¼       â–¼       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Chunking â”‚â”‚Embeddinâ”‚â”‚Vectorâ”‚â”‚LLM    â”‚
   â”‚        â”‚â”‚g       â”‚â”‚Store â”‚â”‚      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚        â”‚       â”‚       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         File System + Ollama
```

---

## ğŸ“ˆ Configuration Options Overview

```
RAG System Configuration
â”‚
â”œâ”€ ğŸ“š Chunking Settings
â”‚  â”œâ”€ chunk_size: 500-2000 tokens (default: 800)
â”‚  â”œâ”€ chunk_overlap: 0-500 tokens (default: 100)
â”‚  â””â”€ min_chunk_size: Minimum chunk size (default: 100)
â”‚
â”œâ”€ ğŸ§  Embedding Settings
â”‚  â”œâ”€ embedding_model: Select model
â”‚  â”‚  â”œâ”€ all-MiniLM-L6-v2 (fast, recommended)
â”‚  â”‚  â”œâ”€ all-MiniLM-L12-v2 (balanced)
â”‚  â”‚  â””â”€ all-mpnet-base-v2 (high quality)
â”‚  â””â”€ embedding_dimension: Auto from model
â”‚
â”œâ”€ ğŸª Vector Store Settings
â”‚  â”œâ”€ vector_db_path: Storage location (./rag_db)
â”‚  â””â”€ collection_name: Index name
â”‚
â”œâ”€ ğŸ¯ Retrieval Settings
â”‚  â”œâ”€ top_k: Results to retrieve (1-10, default: 5)
â”‚  â”œâ”€ similarity_threshold: Min score (0-1, default: 0.3)
â”‚  â””â”€ enable_hybrid_search: Semantic + keyword
â”‚
â””â”€ ğŸ¦™ LLM Settings
   â”œâ”€ ollama_base_url: localhost:11434
   â”œâ”€ ollama_model: Select model
   â”‚  â”œâ”€ gemma2:2b (fastest)
   â”‚  â”œâ”€ llama2:7b (balanced)
   â”‚  â”œâ”€ llama3:8b (best quality)
   â”‚  â””â”€ qwen2.5:7b (multilingual)
   â”œâ”€ temperature: 0.1-1.0 (default: 0.3)
   â”œâ”€ max_tokens: 128-2048 (default: 512)
   â””â”€ context_window: Model size
```

---

## ğŸ”„ API Endpoint Map

```
GET /health
â””â”€ Check system status
   â”œâ”€ rag_enabled
   â”œâ”€ embeddings_model_available
   â”œâ”€ vector_store_ready
   â””â”€ ollama_available

POST /index
â””â”€ Index a document
   â”œâ”€ Input: file_path, clear_existing
   â””â”€ Output: chunks_created, status

POST /query
â””â”€ Query and get answer
   â”œâ”€ Input: query, top_k, include_chunks
   â””â”€ Output: answer, sources, confidence

GET /config
â””â”€ Get current configuration
   â”œâ”€ Returns all config values
   â””â”€ No parameters

PUT /config
â””â”€ Update configuration
   â”œâ”€ Input: JSON with fields to update
   â””â”€ Output: Updated config

GET /stats
â””â”€ System statistics
   â”œâ”€ Document count
   â”œâ”€ Model info
   â””â”€ Config snapshot

POST /clear
â””â”€ Reset system
   â”œâ”€ Clears vector store
   â””â”€ Deletes all indices
```

---

## ğŸ“ Typical User Workflows

### Workflow 1: First-Time User
```
1. Run setup script (setup_rag.sh)
       â–¼
2. Pull a model (ollama pull gemma2:2b)
       â–¼
3. Start backend & Ollama
       â–¼
4. Open Web UI (localhost:5173)
       â–¼
5. Index a document (Index tab)
       â–¼
6. Ask a question (Chat tab)
       â–¼
7. See answer with sources
```

### Workflow 2: Developers
```
1. Read API_REFERENCE.md
       â–¼
2. Test endpoints with curl
       â–¼
3. Integrate RAG API into app
       â–¼
4. Use custom client library
       â–¼
5. Deploy and monitor
```

### Workflow 3: Researchers
```
1. Convert PDF with Marker
       â–¼
2. Index Markdown output
       â–¼
3. Analyze retrieval quality
       â–¼
4. Tune configuration
       â–¼
5. Evaluate results
```

---

## ğŸ“¦ Dependency Graph

```
FastAPI App
â”‚
â”œâ”€ FastAPI
â”œâ”€ Pydantic (validation)
â””â”€ CORS Middleware
   â”‚
   â–¼
RAG Routes (rag_routes.py)
â”‚
â”œâ”€ RAGIndexer
â”‚  â”œâ”€ SemanticChunker
â”‚  â”œâ”€ EmbeddingGenerator
â”‚  â”‚  â””â”€ sentence-transformers
â”‚  â”‚     â””â”€ torch / transformers
â”‚  â””â”€ ChromaVectorStore
â”‚     â””â”€ chromadb
â”‚
â”œâ”€ Retriever
â”‚  â”œâ”€ VectorStore (ChromaDB)
â”‚  â””â”€ EmbeddingGenerator
â”‚
â””â”€ OllamaLLM
   â””â”€ requests (HTTP)
      â””â”€ Ollama API (local)

Frontend (React)
â”‚
â”œâ”€ React 18+
â”œâ”€ useRAGAPI hook
â”‚  â””â”€ fetch API
â”‚     â””â”€ FastAPI Backend
â”‚
â””â”€ Components
   â”œâ”€ RAGPanel
   â”œâ”€ RAGChat
   â”œâ”€ RAGSettings
   â””â”€ RAGIndexer
```

---

## ğŸš€ Performance Characteristics

```
Operation Timing (on M1 Mac)
â”‚
â”œâ”€ Indexing Speed
â”‚  â”œâ”€ Text Chunking: ~5000 tokens/sec
â”‚  â”œâ”€ Embedding Generation: 100-500 tokens/sec
â”‚  â””â”€ ChromaDB Insert: 1000+ chunks/sec
â”‚
â”œâ”€ Query Speed
â”‚  â”œâ”€ Query Embedding: <100ms
â”‚  â”œâ”€ Vector Search: 50-200ms
â”‚  â”œâ”€ LLM Generation: 5-30 seconds (model dependent)
â”‚  â””â”€ Total: 5-31 seconds
â”‚
â””â”€ Memory Usage
   â”œâ”€ Embedding Model: 100-300MB
   â”œâ”€ LLM Model: 2-8GB
   â”œâ”€ ChromaDB Index: ~1-2KB per chunk
   â””â”€ Total: 2.5-8.5GB baseline
```

---

## ğŸ¨ UI Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Marker RAG ğŸ”                    âœ“ System Ready â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ’¬ Chat] [ğŸ“š Index] [âš™ï¸ Settings]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  CHAT TAB CONTENT:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š Document RAG Chat                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  You: What is RAG?                      â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  Assistant (gemma2:2b):                 â”‚   â”‚
â”‚  â”‚  RAG is a technique that combines...    â”‚   â”‚
â”‚  â”‚  [ğŸ“‹ Copy]                              â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  ğŸ“ Sources:                            â”‚   â”‚
â”‚  â”‚  1. document.md (Chunk 0) - 92% match   â”‚   â”‚
â”‚  â”‚     Heading: Introduction...            â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  [Ask a question...] [ğŸ“¤]               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Model

```
Data Flow Security
â”‚
â”œâ”€ Local Processing
â”‚  â”œâ”€ PDFs processed locally (Marker)
â”‚  â”œâ”€ Embeddings generated locally (sentence-transformers)
â”‚  â”œâ”€ LLM queries processed locally (Ollama)
â”‚  â””â”€ No data leaves machine
â”‚
â”œâ”€ Storage
â”‚  â”œâ”€ ChromaDB stored locally (./rag_db)
â”‚  â”œâ”€ Configuration stored locally
â”‚  â”œâ”€ No remote backups
â”‚  â””â”€ Complete local control
â”‚
â””â”€ Recommended Production Additions
   â”œâ”€ Authentication (JWT tokens)
   â”œâ”€ Authorization (role-based access)
   â”œâ”€ Rate limiting (prevent abuse)
   â”œâ”€ HTTPS (encrypt transport)
   â””â”€ Audit logging (track usage)
```

---

## âœ¨ Summary

This visual guide shows:
1. **Architecture**: How all components fit together
2. **Data Flows**: How information moves through system
3. **Configuration**: All tunable parameters
4. **APIs**: Available endpoints
5. **Performance**: Expected speeds and memory
6. **UI**: How the interface is organized
7. **Security**: Privacy-first design

For detailed information, see the comprehensive documentation files!
